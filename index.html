import React, { useState, useEffect, useRef } from 'react';
import { User, Mail, Briefcase, Coffee, MessageSquare, MapPin, Calendar, Clock, CheckCircle, Send, Train, Bus, Car, ExternalLink, Loader2, BarChart2, PieChart, Activity, Users } from 'lucide-react';

// ★★★ 請確認您的 Google Apps Script 網址已更新並重新部署 ★★★
const GOOGLE_SCRIPT_URL = "https://script.google.com/macros/s/AKfycby4dqxwPkUwcCzwFcG4faq4Ui_wdfJdZ7r-FvEa8mtGYCJS1NWeSHKDjwczRCSzPYDy8g/exec"; 

// Canvas Background Component
const ParticleBackground = () => {
  const canvasRef = useRef(null);

  useEffect(() => {
    const canvas = canvasRef.current;
    const ctx = canvas.getContext('2d');
    let animationFrameId;
    let particles = [];
    
    const resizeCanvas = () => {
      canvas.width = window.innerWidth;
      canvas.height = window.innerHeight;
    };
    window.addEventListener('resize', resizeCanvas);
    resizeCanvas();

    class Particle {
      constructor() {
        this.x = Math.random() * canvas.width;
        this.y = Math.random() * canvas.height;
        this.vx = (Math.random() - 0.5) * 1;
        this.vy = (Math.random() - 0.5) * 1;
        this.size = Math.random() * 2 + 1;
        this.color = Math.random() > 0.5 ? 'rgba(6, 182, 212, ' : 'rgba(139, 92, 246, '; 
      }
      update() {
        this.x += this.vx;
        this.y += this.vy;
        if (this.x < 0 || this.x > canvas.width) this.vx *= -1;
        if (this.y < 0 || this.y > canvas.height) this.vy *= -1;
      }
      draw() {
        ctx.beginPath();
        ctx.arc(this.x, this.y, this.size, 0, Math.PI * 2);
        ctx.fillStyle = this.color + '0.7)';
        ctx.fill();
      }
    }

    const initParticles = () => {
      particles = [];
      const numberOfParticles = Math.min(window.innerWidth / 10, 100); 
      for (let i = 0; i < numberOfParticles; i++) {
        particles.push(new Particle());
      }
    };
    initParticles();

    const animate = () => {
      ctx.clearRect(0, 0, canvas.width, canvas.height);
      particles.forEach((particle, index) => {
        particle.update();
        particle.draw();
        for (let j = index; j < particles.length; j++) {
          const dx = particles[index].x - particles[j].x;
          const dy = particles[index].y - particles[j].y;
          const distance = Math.sqrt(dx * dx + dy * dy);
          if (distance < 150) {
            ctx.beginPath();
            ctx.strokeStyle = `rgba(100, 255, 255, ${1 - distance / 150})`;
            ctx.lineWidth = 0.5;
            ctx.moveTo(particles[index].x, particles[index].y);
            ctx.lineTo(particles[j].x, particles[j].y);
            ctx.stroke();
          }
        }
      });
      animationFrameId = requestAnimationFrame(animate);
    };
    animate();

    return () => {
      window.removeEventListener('resize', resizeCanvas);
      cancelAnimationFrame(animationFrameId);
    };
  }, []);

  return (
    <canvas 
      ref={canvasRef} 
      className="fixed top-0 left-0 w-full h-full z-0 pointer-events-none bg-slate-900"
    />
  );
};

// --- Dashboard Components ---

const DashboardCard = ({ title, icon: Icon, children, className = "" }) => (
  <div className={`bg-slate-800/40 backdrop-blur-md border border-slate-700/50 rounded-2xl p-6 shadow-xl hover:border-cyan-500/30 transition-all ${className}`}>
    <h3 className="text-slate-400 text-sm uppercase tracking-wider font-mono mb-4 flex items-center">
      <Icon size={16} className="mr-2 text-cyan-400" />
      {title}
    </h3>
    {children}
  </div>
);

const Dashboard = () => {
  const [data, setData] = useState([]);
  const [loading, setLoading] = useState(true);
  const [error, setError] = useState(null);

  useEffect(() => {
    const fetchData = async () => {
      try {
        const response = await fetch(GOOGLE_SCRIPT_URL);
        const result = await response.json();
        if (result.result === 'success') {
          setData(result.data);
        } else {
          throw new Error('Data format error');
        }
      } catch (err) {
        console.error("Fetch error:", err);
        setError("無法讀取數據，請確認後端已部署為 Web App");
      } finally {
        setLoading(false);
      }
    };
    fetchData();
  }, []);

  if (loading) return (
    <div className="flex flex-col items-center justify-center h-64 space-y-4">
      <Loader2 className="animate-spin text-cyan-400" size={40} />
      <p className="text-slate-400 animate-pulse">正在從神經網絡同步數據...</p>
    </div>
  );

  if (error) return (
    <div className="flex flex-col items-center justify-center h-64 text-red-400">
      <Activity size={40} className="mb-4" />
      <p>{error}</p>
    </div>
  );

  // Statistics Calculation
  const totalCount = data.length;
  
  // Job Title Distribution
  const jobCounts = data.reduce((acc, curr) => {
    const job = curr.jobTitle || '未填寫';
    acc[job] = (acc[job] || 0) + 1;
    return acc;
  }, {});
  const jobDistribution = Object.entries(jobCounts)
    .sort((a, b) => b[1] - a[1]) // Sort by count desc
    .map(([job, count]) => ({ job, count, percent: (count / totalCount) * 100 }));

  // Snacks Distribution
  const snackYes = data.filter(d => d.snacks === '是').length;
  const snackNo = totalCount - snackYes;
  const snackYesPercent = totalCount > 0 ? (snackYes / totalCount) * 100 : 0;

  // Recent Signups (Masked)
  const recentSignups = [...data].reverse().slice(0, 5).map(d => ({
    ...d,
    maskedName: d.name ? d.name[0] + '○'.repeat(Math.max(0, d.name.length - 1)) : '匿名'
  }));

  return (
    <div className="space-y-6 animate-fade-in-up">
      {/* Top Stats Row */}
      <div className="grid grid-cols-1 md:grid-cols-3 gap-6">
        <DashboardCard title="總報名人數" icon={Users} className="relative overflow-hidden group">
           <div className="absolute right-0 top-0 opacity-10 transform translate-x-4 -translate-y-4 group-hover:scale-110 transition-transform">
             <Users size={100} />
           </div>
           <div className="text-5xl font-extrabold text-white mb-2 tracking-tighter">
             {totalCount}
             <span className="text-lg text-slate-500 font-normal ml-2">人</span>
           </div>
           <p className="text-cyan-400 text-sm flex items-center">
             <span className="w-2 h-2 bg-cyan-400 rounded-full mr-2 animate-pulse"></span>
             即時更新中
           </p>
        </DashboardCard>

        <DashboardCard title="餐點需求概況" icon={Coffee}>
          <div className="flex items-center justify-between h-full pb-2">
            <div className="relative w-24 h-24">
               {/* Simple CSS Pie Chart representation */}
               <svg viewBox="0 0 36 36" className="w-24 h-24 transform -rotate-90">
                 <path d="M18 2.0845 a 15.9155 15.9155 0 0 1 0 31.831 a 15.9155 15.9155 0 0 1 0 -31.831" fill="none" stroke="#334155" strokeWidth="4" />
                 <path d="M18 2.0845 a 15.9155 15.9155 0 0 1 0 31.831 a 15.9155 15.9155 0 0 1 0 -31.831" fill="none" stroke="#22d3ee" strokeWidth="4" strokeDasharray={`${snackYesPercent}, 100`} className="animate-[dash_1.5s_ease-out_forwards]" />
               </svg>
               <div className="absolute inset-0 flex items-center justify-center text-xs font-bold text-white">
                 {Math.round(snackYesPercent)}%
               </div>
            </div>
            <div className="flex-1 ml-6 space-y-3">
              <div className="flex justify-between text-sm">
                <span className="text-slate-300">需要餐點</span>
                <span className="text-cyan-400 font-mono">{snackYes}</span>
              </div>
              <div className="flex justify-between text-sm">
                <span className="text-slate-400">不需要</span>
                <span className="text-slate-500 font-mono">{snackNo}</span>
              </div>
            </div>
          </div>
        </DashboardCard>

        <DashboardCard title="最近報名" icon={Activity}>
          <div className="space-y-3">
            {recentSignups.map((p, i) => (
              <div key={i} className="flex justify-between items-center text-sm border-b border-slate-700/50 pb-2 last:border-0 last:pb-0">
                <div className="flex items-center">
                  <div className="w-1.5 h-1.5 bg-green-500 rounded-full mr-2"></div>
                  <span className="text-slate-300">{p.maskedName}</span>
                </div>
                <span className="text-xs text-slate-500 px-2 py-0.5 bg-slate-700 rounded-full">{p.jobTitle}</span>
              </div>
            ))}
            {recentSignups.length === 0 && <p className="text-slate-500 text-sm">尚無資料</p>}
          </div>
        </DashboardCard>
      </div>

      {/* Main Chart Row */}
      <DashboardCard title="職稱分佈分析" icon={BarChart2} className="min-h-[300px]">
        <div className="space-y-4 mt-2">
          {jobDistribution.map((item, index) => (
            <div key={index} className="group">
              <div className="flex justify-between text-sm mb-1">
                <span className="text-white group-hover:text-cyan-300 transition-colors">{item.job}</span>
                <span className="text-slate-400 font-mono">{item.count} 人 ({Math.round(item.percent)}%)</span>
              </div>
              <div className="w-full bg-slate-700/50 rounded-full h-3 overflow-hidden">
                <div 
                  className="bg-gradient-to-r from-cyan-500 to-blue-600 h-full rounded-full transition-all duration-1000 ease-out group-hover:shadow-[0_0_10px_cyan]"
                  style={{ width: `${item.percent}%` }}
                ></div>
              </div>
            </div>
          ))}
          {jobDistribution.length === 0 && <p className="text-slate-500 text-center py-10">尚無統計數據</p>}
        </div>
      </DashboardCard>
    </div>
  );
};


// Main Application Component
export default function App() {
  const [view, setView] = useState('form'); // 'form' or 'dashboard'
  const [formData, setFormData] = useState({
    name: '',
    email: '',
    jobTitle: '',
    snacks: '',
    questions: ''
  });
  const [submitted, setSubmitted] = useState(false);
  const [isSubmitting, setIsSubmitting] = useState(false);
  const [errorMsg, setErrorMsg] = useState('');

  const handleChange = (e) => {
    const { name, value } = e.target;
    setFormData(prev => ({ ...prev, [name]: value }));
  };

  const handleSubmit = async (e) => {
    e.preventDefault();
    setIsSubmitting(true);
    setErrorMsg('');

    if (GOOGLE_SCRIPT_URL.includes("您的_GOOGLE_APPS_SCRIPT")) {
      alert("請先設定程式碼中的 GOOGLE_SCRIPT_URL 變數！");
      setIsSubmitting(false);
      return;
    }

    try {
      const response = await fetch(GOOGLE_SCRIPT_URL, {
        method: 'POST',
        headers: {
          'Content-Type': 'text/plain;charset=utf-8',
        },
        body: JSON.stringify(formData),
      });

      setSubmitted(true);
      window.scrollTo({ top: 0, behavior: 'smooth' });
      
    } catch (error) {
      console.error("Submission Error:", error);
      setErrorMsg("傳送失敗，請稍後再試。");
    } finally {
      setIsSubmitting(false);
    }
  };

  return (
    <div className="min-h-screen text-white font-sans selection:bg-cyan-500 selection:text-black overflow-x-hidden relative">
      <ParticleBackground />
      <div className="fixed inset-0 z-0 opacity-10 pointer-events-none" 
           style={{ backgroundImage: 'linear-gradient(rgba(6, 182, 212, 0.1) 1px, transparent 1px), linear-gradient(90deg, rgba(6, 182, 212, 0.1) 1px, transparent 1px)', backgroundSize: '50px 50px' }}>
      </div>

      <div className="relative z-10 container mx-auto px-4 py-12 flex flex-col items-center justify-center min-h-screen">
        
        {/* Header Section */}
        <header className="text-center mb-10 animate-fade-in-down w-full max-w-4xl">
          <div className="inline-block mb-4 px-4 py-1 rounded-full border border-cyan-400/50 bg-cyan-900/20 backdrop-blur-sm text-cyan-300 text-sm font-mono tracking-widest shadow-[0_0_15px_rgba(6,182,212,0.3)]">
            AGILE MINDSET 2025
          </div>
          <h1 className="text-4xl md:text-6xl font-extrabold mb-4 bg-clip-text text-transparent bg-gradient-to-r from-cyan-400 via-blue-500 to-purple-600 drop-shadow-lg">
            HELLO WORLD 2025
          </h1>
          <h2 className="text-xl md:text-2xl text-slate-300 font-light tracking-wide mb-8">
            開發者大會心得分享暨實務研討會
          </h2>
          
          {/* View Toggle Buttons */}
          <div className="flex justify-center space-x-4 mb-8">
            <button 
              onClick={() => setView('form')}
              className={`px-6 py-2 rounded-full font-medium transition-all duration-300 flex items-center ${
                view === 'form' 
                ? 'bg-cyan-600 text-white shadow-[0_0_15px_cyan]' 
                : 'bg-slate-800 text-slate-400 hover:bg-slate-700'
              }`}
            >
              <Send size={16} className="mr-2" />
              線上報名
            </button>
            <button 
              onClick={() => setView('dashboard')}
              className={`px-6 py-2 rounded-full font-medium transition-all duration-300 flex items-center ${
                view === 'dashboard' 
                ? 'bg-purple-600 text-white shadow-[0_0_15px_purple]' 
                : 'bg-slate-800 text-slate-400 hover:bg-slate-700'
              }`}
            >
              <BarChart2 size={16} className="mr-2" />
              報名現況
            </button>
          </div>
        </header>

        {/* View Switcher */}
        {view === 'dashboard' ? (
           <div className="w-full max-w-5xl">
             <Dashboard />
           </div>
        ) : (
        <div className="grid grid-cols-1 lg:grid-cols-3 gap-8 w-full max-w-6xl">
          
          {/* Left Column - Info & Traffic */}
          <div className="lg:col-span-1 space-y-6">

            {/* Event Info Card */}
            <div className="bg-slate-800/40 backdrop-blur-md border border-slate-700/50 rounded-2xl p-6 shadow-2xl hover:border-cyan-500/50 transition-all duration-300 group">
              <h3 className="text-xl font-bold text-white mb-6 flex items-center border-b border-slate-700 pb-3">
                <span className="w-2 h-8 bg-cyan-500 mr-3 rounded-full shadow-[0_0_10px_cyan]"></span>
                活動資訊
              </h3>
              
              <div className="space-y-6">
                <div className="flex items-start space-x-4 group-hover:translate-x-1 transition-transform">
                  <div className="p-3 rounded-lg bg-blue-500/10 text-blue-400">
                    <Calendar size={24} />
                  </div>
                  <div>
                    <p className="text-slate-400 text-sm uppercase tracking-wider">Date</p>
                    <p className="text-lg font-semibold text-white">2025 年 11 月 30 日</p>
                    <p className="text-slate-400 text-sm">(星期日)</p>
                  </div>
                </div>

                <div className="flex items-start space-x-4 group-hover:translate-x-1 transition-transform delay-75">
                  <div className="p-3 rounded-lg bg-purple-500/10 text-purple-400">
                    <Clock size={24} />
                  </div>
                  <div>
                    <p className="text-slate-400 text-sm uppercase tracking-wider">Time</p>
                    <p className="text-lg font-semibold text-white">14:00 - 17:00</p>
                    <p className="text-slate-400 text-sm">共 3 小時</p>
                  </div>
                </div>

                <div className="flex items-start space-x-4 group-hover:translate-x-1 transition-transform delay-100">
                  <div className="p-3 rounded-lg bg-cyan-500/10 text-cyan-400">
                    <MapPin size={24} />
                  </div>
                  <div>
                    <p className="text-slate-400 text-sm uppercase tracking-wider">Location</p>
                    <p className="text-lg font-semibold text-white">奇美博物館</p>
                  </div>
                </div>
              </div>
            </div>
            
            {/* Traffic Info Card */}
            <div className="bg-slate-800/40 backdrop-blur-md border border-slate-700/50 rounded-2xl p-6 shadow-2xl hover:border-purple-500/50 transition-all duration-300 group">
              <h3 className="text-xl font-bold text-white mb-6 flex items-center border-b border-slate-700 pb-3">
                <span className="w-2 h-8 bg-purple-500 mr-3 rounded-full shadow-[0_0_10px_purple]"></span>
                交通資訊
              </h3>
              <div className="space-y-6">
                <div className="flex items-start space-x-4 group-hover:translate-x-1 transition-transform">
                  <div className="p-3 rounded-lg bg-orange-500/10 text-orange-400 shrink-0">
                    <Train size={20} />
                  </div>
                  <div className="w-full">
                    <p className="text-slate-400 text-xs uppercase tracking-wider font-mono">HSR / TRAIN</p>
                    <p className="text-white font-semibold">高鐵 / 台鐵</p>
                    <ul className="text-slate-400 text-sm mt-1 space-y-1 list-disc list-outside ml-4 mb-4">
                      <li>高鐵台南站：搭乘 H31 接駁車至奇美博物館</li>
                      <li>保安火車站：步行約 15 分鐘可抵達</li>
                    </ul>
                    <div className="mt-3 mb-2">
                      <div className="rounded-xl overflow-hidden border border-slate-600/50 shadow-lg relative group-hover:shadow-[0_0_15px_rgba(168,85,247,0.2)] transition-all duration-300 h-48">
                        <iframe 
                          width="100%" 
                          height="100%" 
                          frameBorder="0" 
                          title="Google Map to Chimei Museum"
                          marginHeight="0" 
                          marginWidth="0" 
                          src="https://maps.google.com/maps?q=奇美博物館&t=&z=15&ie=UTF8&iwloc=&output=embed"
                          style={{ filter: 'invert(90%) hue-rotate(180deg) contrast(85%)' }} 
                          className="w-full h-full opacity-80 hover:opacity-100 transition-opacity"
                        ></iframe>
                        <div className="absolute inset-0 pointer-events-none border border-purple-500/10 rounded-xl"></div>
                        <div className="absolute inset-0 pointer-events-none opacity-10 bg-[url('https://www.transparenttextures.com/patterns/diagmonds-light.png')]"></div>
                      </div>
                      <a 
                        href="https://maps.google.com?q=奇美博物館" 
                        target="_blank" 
                        rel="noreferrer"
                        className="flex items-center justify-end mt-2 text-xs text-purple-400 hover:text-purple-300 transition-colors gap-1 group/link"
                      >
                        <span className="group-hover/link:underline underline-offset-4">開啟 Google Maps 導航</span>
                        <ExternalLink size={12} className="transform group-hover/link:translate-x-0.5 group-hover/link:-translate-y-0.5 transition-transform" />
                      </a>
                    </div>
                  </div>
                </div>
                <div className="flex items-start space-x-4 group-hover:translate-x-1 transition-transform delay-75">
                  <div className="p-3 rounded-lg bg-pink-500/10 text-pink-400 shrink-0">
                    <Bus size={20} />
                  </div>
                  <div>
                    <p className="text-slate-400 text-xs uppercase tracking-wider font-mono">BUS LINES</p>
                    <p className="text-white font-semibold">公車資訊</p>
                    <p className="text-slate-400 text-sm mt-1">紅3、紅4、市區公車 5 號</p>
                  </div>
                </div>
                <div className="flex items-start space-x-4 group-hover:translate-x-1 transition-transform delay-100">
                  <div className="p-3 rounded-lg bg-green-500/10 text-green-400 shrink-0">
                    <Car size={20} />
                  </div>
                  <div>
                    <p className="text-slate-400 text-xs uppercase tracking-wider font-mono">DRIVING</p>
                    <p className="text-white font-semibold">自行開車</p>
                    <p className="text-slate-400 text-sm mt-1 text-justify">
                      國道 1 或 3 號 → 台 86 線 (往西) → 台南交流道下 → 台一線
                    </p>
                  </div>
                </div>
              </div>
            </div>

            <div className="bg-gradient-to-r from-cyan-500/20 to-purple-500/20 rounded-2xl p-6 border border-white/5 backdrop-blur-sm hidden lg:block">
              <div className="text-center">
                <p className="text-sm text-cyan-300 font-mono mb-2">SYSTEM STATUS</p>
                <div className="flex justify-center items-center space-x-2">
                  <span className="relative flex h-3 w-3">
                    <span className="animate-ping absolute inline-flex h-full w-full rounded-full bg-green-400 opacity-75"></span>
                    <span className="relative inline-flex rounded-full h-3 w-3 bg-green-500"></span>
                  </span>
                  <span className="text-green-400 font-bold tracking-widest">ONLINE</span>
                </div>
                <p className="text-xs text-slate-400 mt-2">Registration Protocol Active</p>
              </div>
            </div>
          </div>

          {/* Right: Registration Form */}
          <div className="lg:col-span-2">
            <div className="relative bg-slate-900/60 backdrop-blur-xl border border-slate-600/30 rounded-3xl p-8 shadow-[0_0_50px_rgba(0,0,0,0.5)] overflow-hidden">
              
              <div className="absolute top-0 left-0 w-full h-1 bg-gradient-to-r from-transparent via-cyan-500 to-transparent opacity-50"></div>

              {!submitted ? (
                <form onSubmit={handleSubmit} className="space-y-6 relative z-10">
                  <div className="flex items-center justify-between mb-8">
                    <h3 className="text-2xl font-bold text-white">線上報名通道</h3>
                    <span className="px-3 py-1 bg-cyan-900/30 border border-cyan-500/30 rounded text-xs text-cyan-300 font-mono">SECURE FORM</span>
                  </div>

                  {/* Name & Email */}
                  <div className="grid grid-cols-1 md:grid-cols-2 gap-6">
                    <div className="group">
                      <label className="block text-slate-400 text-sm mb-2 ml-1 group-focus-within:text-cyan-400 transition-colors">姓名</label>
                      <div className="relative">
                        <User className="absolute left-4 top-3.5 text-slate-500 group-focus-within:text-cyan-400 transition-colors" size={20} />
                        <input 
                          type="text" 
                          name="name"
                          required
                          disabled={isSubmitting}
                          className="w-full bg-slate-800/50 border border-slate-700 rounded-xl py-3 pl-12 pr-4 text-white placeholder-slate-600 focus:outline-none focus:border-cyan-500 focus:ring-1 focus:ring-cyan-500 disabled:opacity-50 transition-all"
                          placeholder="請輸入您的姓名"
                          value={formData.name}
                          onChange={handleChange}
                        />
                      </div>
                    </div>

                    <div className="group">
                      <label className="block text-slate-400 text-sm mb-2 ml-1 group-focus-within:text-cyan-400 transition-colors">電子郵件 (Email)</label>
                      <div className="relative">
                        <Mail className="absolute left-4 top-3.5 text-slate-500 group-focus-within:text-cyan-400 transition-colors" size={20} />
                        <input 
                          type="email" 
                          name="email"
                          required
                          disabled={isSubmitting}
                          className="w-full bg-slate-800/50 border border-slate-700 rounded-xl py-3 pl-12 pr-4 text-white placeholder-slate-600 focus:outline-none focus:border-cyan-500 focus:ring-1 focus:ring-cyan-500 disabled:opacity-50 transition-all"
                          placeholder="example@hospital.org"
                          value={formData.email}
                          onChange={handleChange}
                        />
                      </div>
                    </div>
                  </div>

                  {/* Job Title */}
                  <div className="group">
                    <label className="block text-slate-400 text-sm mb-2 ml-1 group-focus-within:text-cyan-400 transition-colors">職稱 <span className="text-red-400">*</span></label>
                    <div className="relative">
                      <Briefcase className="absolute left-4 top-3.5 text-slate-500 group-focus-within:text-cyan-400 transition-colors" size={20} />
                      <select 
                        name="jobTitle"
                        required
                        disabled={isSubmitting}
                        className="w-full bg-slate-800/50 border border-slate-700 rounded-xl py-3 pl-12 pr-4 text-white focus:outline-none focus:border-cyan-500 focus:ring-1 focus:ring-cyan-500 disabled:opacity-50 transition-all appearance-none cursor-pointer"
                        value={formData.jobTitle}
                        onChange={handleChange}
                      >
                        <option value="" disabled>-- 請選擇您的職稱 --</option>
                        <option value="醫師" className="bg-slate-800">醫師</option>
                        <option value="護理師" className="bg-slate-800">護理師</option>
                        <option value="醫事人員" className="bg-slate-800">醫事人員</option>
                        <option value="行政人員" className="bg-slate-800">行政人員</option>
                        <option value="其他" className="bg-slate-800">其他</option>
                      </select>
                      <div className="absolute right-4 top-4 pointer-events-none border-t-4 border-t-slate-400 border-l-4 border-l-transparent border-r-4 border-r-transparent"></div>
                    </div>
                  </div>

                  {/* Snacks */}
                  <div className="group">
                    <label className="block text-slate-400 text-sm mb-3 ml-1">是否需要茶水點心？</label>
                    <div className="flex space-x-6">
                      <label className="relative flex items-center cursor-pointer group/radio">
                        <input 
                          type="radio" 
                          name="snacks" 
                          value="yes" 
                          className="peer sr-only"
                          disabled={isSubmitting}
                          onChange={handleChange}
                          checked={formData.snacks === 'yes'}
                        />
                        <div className="w-6 h-6 border-2 border-slate-600 rounded-full peer-checked:border-cyan-400 peer-checked:shadow-[0_0_10px_cyan] transition-all flex items-center justify-center">
                          <div className="w-3 h-3 bg-cyan-400 rounded-full opacity-0 peer-checked:opacity-100 transition-opacity"></div>
                        </div>
                        <span className="ml-3 text-slate-300 group-hover/radio:text-white transition-colors">是，我需要</span>
                        <Coffee className="ml-2 text-slate-500 peer-checked:text-amber-400 transition-colors" size={18}/>
                      </label>
                      
                      <label className="relative flex items-center cursor-pointer group/radio">
                        <input 
                          type="radio" 
                          name="snacks" 
                          value="no" 
                          className="peer sr-only"
                          disabled={isSubmitting}
                          onChange={handleChange}
                          checked={formData.snacks === 'no'}
                        />
                        <div className="w-6 h-6 border-2 border-slate-600 rounded-full peer-checked:border-purple-400 peer-checked:shadow-[0_0_10px_purple] transition-all flex items-center justify-center">
                          <div className="w-3 h-3 bg-purple-400 rounded-full opacity-0 peer-checked:opacity-100 transition-opacity"></div>
                        </div>
                        <span className="ml-3 text-slate-300 group-hover/radio:text-white transition-colors">否</span>
                      </label>
                    </div>
                  </div>

                  {/* Questions */}
                  <div className="group">
                    <label className="block text-slate-400 text-sm mb-2 ml-1 group-focus-within:text-cyan-400 transition-colors">會前提問</label>
                    <div className="relative">
                      <MessageSquare className="absolute left-4 top-3.5 text-slate-500 group-focus-within:text-cyan-400 transition-colors" size={20} />
                      <textarea 
                        name="questions"
                        disabled={isSubmitting}
                        className="w-full bg-slate-800/50 border border-slate-700 rounded-xl py-3 pl-12 pr-4 text-white placeholder-slate-600 focus:outline-none focus:border-cyan-500 focus:ring-1 focus:ring-cyan-500 disabled:opacity-50 transition-all min-h-[100px]"
                        placeholder="您目前在行政工作上遇到的困難？或最想了解關於「敏捷」的哪個部分？"
                        value={formData.questions}
                        onChange={handleChange}
                      />
                    </div>
                  </div>

                  {errorMsg && (
                    <div className="text-red-400 text-sm text-center bg-red-900/20 p-2 rounded border border-red-500/30">
                      {errorMsg}
                    </div>
                  )}

                  {/* Submit Button */}
                  <button 
                    type="submit"
                    disabled={isSubmitting}
                    className="w-full py-4 mt-4 bg-gradient-to-r from-cyan-600 to-blue-600 hover:from-cyan-500 hover:to-blue-500 disabled:from-slate-600 disabled:to-slate-600 disabled:cursor-not-allowed text-white font-bold rounded-xl shadow-lg shadow-cyan-500/30 hover:shadow-cyan-500/50 transform hover:-translate-y-0.5 transition-all duration-200 flex items-center justify-center group"
                  >
                    {isSubmitting ? (
                      <span className="flex items-center">
                        <Loader2 className="animate-spin mr-2" size={20} />
                        資料傳送中...
                      </span>
                    ) : (
                      <>
                        <span className="mr-2 tracking-widest">確認報名</span>
                        <Send size={20} className="group-hover:translate-x-1 transition-transform" />
                      </>
                    )}
                  </button>
                </form>
              ) : (
                <div className="flex flex-col items-center justify-center py-16 text-center animate-fade-in">
                  <div className="w-20 h-20 bg-green-500/20 rounded-full flex items-center justify-center mb-6 shadow-[0_0_20px_rgba(34,197,94,0.5)]">
                    <CheckCircle size={40} className="text-green-400" />
                  </div>
                  <h3 className="text-3xl font-bold text-white mb-2">報名成功！</h3>
                  <p className="text-slate-300 mb-8">我們已收到您的資料，並將資料同步至雲端資料庫。</p>
                  <div className="p-4 bg-slate-800/50 rounded-lg border border-slate-700 text-sm text-slate-400 max-w-md">
                    <p>系統將自動發送確認信至您的信箱：</p>
                    <p className="text-cyan-400 mt-1">{formData.email}</p>
                  </div>
                  <button 
                    onClick={() => {setSubmitted(false); setFormData({...formData, questions: '', snacks: ''})}}
                    className="mt-8 text-slate-500 hover:text-white underline underline-offset-4 transition-colors"
                  >
                    填寫下一筆報名
                  </button>
                </div>
              )}
            </div>
          </div>
        </div>
        )}

        {/* Footer */}
        <footer className="mt-20 text-center text-slate-500 text-sm border-t border-slate-800 pt-8 w-full max-w-4xl">
          <p className="mb-2">主辦單位：教學部 &nbsp;|&nbsp; 聯絡人：盧英云 (分機 57425)</p>
          <p className="text-xs text-slate-600">本報名資料僅供本次研討會聯繫與餐點統計使用，我們將嚴格保護您的個人隱私。</p>
          <p className="mt-4 text-xs font-mono text-slate-700">POWERED BY AGILE TECH © 2025</p>
        </footer>

      </div>
    </div>
  );
}
